<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="format-detection" content="telephone=no" />
	<meta name="msapplication-tap-highlight" content="no" />
	<meta name="viewport"
	content="initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />

	<!-- Include the local stylesheets -->
	<link rel="stylesheet" type="text/css" href="../css/organisation.css" />
	<link rel="stylesheet" type="text/css"
	href="../css/list_organisation.css">

	<!-- Include the jQuery library -->
	<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>

	<!-- Include the jQuery Mobile library -->
	<script
	src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

	<!-- Include the jQuery Dotdotdot library -->
	<script src="../js/jquery.dotdotdot.min.js"></script>


	<!-- Include jQuery Mobile stylesheets -->
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
	<script type="text/javascript" src="../js/urls.js"></script>


	<script type="text/javascript">

	$(document).ready(function(){


		$(document.body).on('click', 'li', function() {
			setLocalStorageProjectToShow(this.id);

		});
		$(document.body).on('click', 'a[name="donation"]', function() {
			setLocalStorageProjectToShow(this.id);

		});

		var organizationNr = localStorage.getItem("organizationToShow");

		var sql = "SELECT * FROM Organization WHERE organizationNr ='" + organizationNr + "'";

		var url = getURLphpBackendGetOrganizations();
		$.ajax({
			type : "POST",
			url : url,
			dataType: "JSON",
			data : {'organizationSQL' : sql},
			success : function(response){
				var organization_name = response[0].name;
				var category = response[0].category;
				var about_organization = response[0].about;
				var logoURL = response[0].logoURL;
				var backgroundimgURL = response[0].backgroundimgURL;
				var organizationNr = response[0].organizationNr;

				$('span[name=category]').append(category);
				$('p[name=organization_name]').text(organization_name); 
				$('h2[name=organization_name]').text(organization_name); 
				$('p[name=ingress]').text(about_organization); 
				$('img[name=logo]').attr("src", logoURL );
				$('img[name=background]').attr("src", backgroundimgURL);


				appendProjectList(organizationNr);
			},
			error: function(){
				alert("Error in organization.html js ajax bad request");
			}
		});

			/*
			*/


			function appendProjectList(organizationNr){
				var sql = "SELECT * FROM Project WHERE organizationNr ='" + organizationNr + "'";
				var url = getURLphpBackendGetProjects();
				$.ajax({
					type : "POST",
					url : url,
					dataType: "JSON",
					data : {"projectSQL" : sql},
					success : function(response){
						for(var i = 0; i < response.length; i++){
							var projectCode = 
							'<li id="' + response[i].projectID +'">'+
							'<div class="li_container">' +
							'<div class="li_left">'+
							'<div class="li_circ"><img src="#"></div>'+
							'</div>'+
							'<a href="project.html" rel="external" class="show-page-loading-msg">'+
							'<div class="li_mid dots">'+
							'<span class="li_heading">' + response[i].name + '</span>'+
							'<span class="li_text"></span>'+
							'</div>'+
							'</a>'+
							'<div class="li_right">'+
							'<a href="donate.html" rel="external" class="li_btn_donate show-page-loading-msg" id="' + response[i].projectID +'" name="donation">DONÉR</a>'+
							'</div>'+
							'</div>'+
							'</li>';

							$('ul[name=projectList]').append(projectCode);
						}


					}
				});

			}

			function setLocalStorageProjectToShow(projectID){
				localStorage['projectToShow'] = projectID;
			}



		});	





</script>

</head>
<body>
	<div data-role="page" id="page_organisation" data-theme="a">
		<div id="header_div" class="boxshadow">
			<div class="header_top"></div>
			<img src="../img/menu.png" class="menu_icon">
			<p name="organization_name">Org.navn</p>
		</div>
		<div class="portrait">
			<img name="background"style="height:100%; width:100%;" alt="[background image]">
			<img class="logodiv_left" name="logo"/>

		</div>
		<div class="top_links">
			<a href="#">Nyheter</a> <a href="#">Om organisasjonen</a>
		</div>
		<div class="main_content">
			<span class="grey" name="category">Kategori: </span>
			<h2 class="orgname" name="organization_name">Navn på Org.</h2>
			<p class="ingress" name="ingress">[about this organization]</p>


			<div class="listdiv">
				<h3>Pågående prosjekter</h3>
				<ul data-role="none" data-inset="true" id="list_organisation" name="projectList">


					
					
					
				</ul>
			</div>

			<div class="somespace"></div>

			<footer data-role="footer" data-position="fixed">
				<div data-role="navbar">
					<ul>
						<li class="footer_me"><img class="footer_menu_icon" alt=""
							src="../img/icon_menu_footer_me.png"></li>
							<li class="footer_overview"><img class="footer_menu_icon"
								alt="" src="../img/icon_menu_footer_overview.png"></li>
								<li class="footer_friends"><img class="footer_menu_icon"
									alt="" src="../img/icon_menu_footer_friends.png"></li>
									<li class="footer_settings"><img class="footer_menu_icon"
										alt="" src="../img/icon_menu_footer_settings.png"></li>
									</ul>
								</div>
							</footer>
						</div>
					</div>
				</body>

				<<script>
				$(".footer_me").click(function() {
					window.location.href = "";
				});

				$(".footer_overview").click(function() {
					window.location.href = "overview.html";
				});

				$(".footer_friends").click(function() {
					window.location.href = "my_friends.html";
				});

				$(".footer_settings").click(function() {
					window.location.href = "";
				});
				</script>

				</html>